# n8n-nodes-omnara

This is an n8n community node that lets you interact with [Omnara](https://omnara.com) AI agents in your n8n workflows.

Omnara allows you to communicate with your AI agents from anywhere, enabling real-time interaction and human-in-the-loop workflows.

## Installation

### Community Node (Recommended)

In n8n, go to **Settings** > **Community Nodes** and search for `n8n-nodes-omnara`.

### Manual Installation

1. Clone or download this repository
2. In the repository folder, run:
   ```bash
   npm install
   npm run build
   ```
3. Copy the `dist` folder to your n8n custom nodes folder
4. Restart n8n

### Development Installation

For development and testing:

```bash
# Install dependencies
npm install

# Build the node
npm run build

# For development with auto-rebuild
npm run dev

# Link to n8n for testing
npm link
# In your n8n installation:
npm link n8n-nodes-omnara
```

## Authentication

1. Get your API key from your [Omnara dashboard](https://app.omnara.io)
2. In n8n, create new Omnara credentials:
   - **API Key**: Your Omnara API key
   - **Server URL**: `https://api.omnara.io` (or your custom deployment URL)

## Operations

### Message Resource

#### Send Message
Send a message to an Omnara agent and optionally receive queued user messages.

**Parameters:**
- **Agent Instance ID**: The ID of the agent instance (creates new if doesn't exist)
- **Message**: The content to send
- **Additional Options**:
  - Agent Type: Type of agent (e.g., 'claude_code', 'cursor')
  - Git Diff: Git diff content to store
  - Send Email/SMS/Push: Notification preferences

#### Send and Wait
Send a message and wait for a user response. Perfect for approval workflows and human-in-the-loop scenarios.

**Parameters:**
- **Agent Instance ID**: The ID of the agent instance
- **Message**: The question or message requiring user input
- **Wait Options**:
  - Timeout: How long to wait (default 24 hours)
  - Webhook Suffix: Optional URL suffix for identification
- **Additional Options**: Same as Send Message

**How it works:**
1. Sends message to Omnara with `requires_user_input: true`
2. Generates a webhook URL and stores it with the message
3. Pauses workflow execution
4. When user responds in Omnara dashboard, workflow resumes with the response

### Session Resource

#### End Session
End an agent session and mark it as completed.

**Parameters:**
- **Agent Instance ID**: The ID of the agent instance session to end

## Usage Examples

### Basic Message Send
```javascript
// Send a status update to your agent
{
  "resource": "message",
  "operation": "send",
  "agentInstanceId": "agent-123",
  "content": "Build completed successfully"
}
```

### Approval Workflow
```javascript
// Ask for approval and wait for response
{
  "resource": "message",
  "operation": "sendAndWait",
  "agentInstanceId": "agent-456",
  "content": "Deploy to production? Please approve or decline.",
  "sendEmail": true,
  "sendPush": true
}
```

### End Session
```javascript
// Mark agent session as completed
{
  "resource": "session",
  "operation": "end",
  "agentInstanceId": "agent-789"
}
```

## Agent Tool Support

This node is configured with `usableAsTool: true`, making it available as a tool for AI agents in n8n. Agents can:
- Send status updates
- Ask for human input and wait for responses
- Manage agent sessions

## Webhook Integration

The Send and Wait operation uses n8n's built-in webhook functionality:
- Webhook URLs are automatically generated by n8n
- Omnara stores the webhook URL and triggers it when users respond
- Workflows resume with the user's response data
- Supports timeout configuration (max 7 days)

## Error Handling

The node includes comprehensive error handling:
- Authentication failures
- Invalid agent instance IDs
- Timeout handling for wait operations
- Network errors and API issues

All operations support the "Continue On Fail" option in n8n.

## Development

### Building
```bash
npm run build
```

### Linting
```bash
npm run lint
npm run lint:fix
```

### Code Formatting
```bash
npm run format
```

## Resources

- [Omnara GitHub](https://github.com/omnara-ai/omnara)
- [n8n Documentation](https://docs.n8n.io)
- [n8n Community Nodes](https://docs.n8n.io/integrations/community-nodes/)

## License

MIT

## Support

For issues and questions:
- [GitHub Issues](https://github.com/omnara-ai/omnara/issues)
- Email: contact@omnara.com